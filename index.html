<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Secure Access Page</title>
  <style>
    #fallbackLink {
      display: none;
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
  <script>
    async function checkVPN() {
      let redirectLink = null;
      let fallbackLink = null;
      let apiKey = null;

      // Load config.json (redirects + API key)
      try {
        const configResponse = await fetch('config.json');
        const config = await configResponse.json();
        redirectLink = config.redirect_link || null;
        fallbackLink = config.fallback_link || null;
        apiKey = config.iphub_api_key || null;

        if (fallbackLink) {
          const fallback = document.getElementById("fallbackLink");
          fallback.href = fallbackLink;
          fallback.style.display = "inline-block";
        }

        if (!apiKey) {
          document.body.innerHTML = "<h2>Missing IPHub API key in configuration.</h2>";
          return; }
      } catch (e) {
        document.body.innerHTML = "<h2>Failed to load configuration. Please try again later.</h2>";
        return;
      }

      // VPN detection using IPHub
      try {
        const response = await fetch('https://v2.api.iphub.info/ip', {
          headers: { 'X-Key': apiKey }
        });

        const data = await response.json();
        const isVPN = data.block === 1 || data.block === 2;

        if (isVPN) {
          document.body.innerHTML = "<h2>Access denied. VPN or proxy use detected. Please disable it to proceed.</h2>";
        } else if (redirectLink) {
          setTimeout(() => {
            window.location.href = redirectLink;
          }, 3000);
        } else {
          document.body.innerHTML = "<h2>No redirect link found in config.</h2>";
        }
      } catch (error) {
        document.body.innerHTML = "<h2>Error verifying connection. Try again later.</h2>";
      }
    }

    window.onload = checkVPN;
  </script>
</head>
<body>  <p>Checking your connection. Please wait...</p>
  <a id="fallbackLink" href="#" style="display:none;">Click here if you are not redirected automatically</a>
</body>
</html>